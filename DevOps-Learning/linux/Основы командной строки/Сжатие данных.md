В прошлом уроке мы рассмотрели **tar** — архиватор, который умеет складывать множество файлов в один архив и при необходимости сжимать его (через gzip, bzip2 или xz). Теперь разберёмся, как работают сами утилиты **сжатия** — если нам нужно сжать (или распаковать) отдельные файлы без tar, а также в чём отличие популярных алгоритмов gzip, bzip2, xz и т. д.

### gzip/gunzip

- `**gzip <файл>**` сжимает указанный файл, создавая _<файл>.gz_.
- `**gunzip <файл.gz>**` — распаковывает (или `gzip -d`).

```php-template
Проверка целостности: bzip2 -t <файл.bz2>
```

- **По умолчанию** удаляет исходный файл, заменяя его на сжатую версию. Если хотите сохранить оригинал, используйте опцию `-k` (не во всех дистрибутивах, зависит от версии gzip).
- **Пример**:
    
    ```bash
    gzip myfile.txt
    ls
    ```
    
    Теперь вместо `myfile.txt` вы увидите `myfile.txt.gz`.
- **Опции сжатия**:
    - `gzip -1` (или `--fast`) — быстро, но с меньшей степенью сжатия.
    - `gzip -9` (или `--best`) — максимальное сжатие, но медленнее.
- Формат `.gz` — один из самых распространённых в Linux для одиночных файлов или вместе с tar (`.tar.gz`).

> **Флаг `-k`** позволяет сохранить оригинальный файл. Без него исходный файл удаляется

### bzip2/bunzip2

- `**bzip2 <файл>**` сжимает файл, создавая _<файл>.bz2_.
- `**bunzip2 <файл.bz2>**` — распаковывает (или `bzip2 -d`).
- **Особенности**:
    - Сжимает лучше (но обычно медленнее), чем gzip.
    - Расширение `.bz2` часто используется совместно с tar (`.tar.bz2`).
- **Пример**:
    
    ```lua
    bzip2 hugefile.log
    ```
    
    Теперь имеем `hugefile.log.bz2`.

Для проверки целостности сжатого файла используйте команду:

```applescript
bzip2 -t file.bz2
```

### xz/unxz

- `**xz <файл>**` создаёт _<файл>.xz_, `**unxz <файл.xz>**` распаковывает.

```1c
Сохранить исходный файл: xz -k <файл>
Ограничить память при сжатии: xz --memlimit-compress=100M <файл>
```

- `**.xz**` — современный формат, часто даёт _ещё более высокое_ сжатие, чем bzip2, но иногда работает медленнее (особенно на слабом железе).
- **Тоже применяется с tar** (`.tar.xz` или `.txz`).

> Чтобы оставить оригинал при сжатии, используйте `xz -k`.

Чтобы ограничить использование оперативной памяти при сжатии, используйте опцию `--memlimit-compress=<размер>`. Например:

```lua
xz --memlimit-compress=50MiB file.txt
```

### zip/unzip

- `**zip**` — не только сжимает, но и может работать с несколькими файлами/папками сразу (без tar). Получается _<файл>.zip_.
- `**unzip**` — распаковывает .zip-архивы.
- Формат `.zip` распространён в Windows и macOS, часто используется, когда нужно передавать архив «потребителям, которые не знают tar/gzip».
- **Пример**:
    
    ```python
    zip -r myarchive.zip folder/
    unzip myarchive.zip
    ```
    
    > **Флаг `-r`** в zip означает рекурсивное добавление файлов из каталога.
    

```python
Исключить файлы по маске: zip -r archive.zip <папка> -x '*.log'
```

### Какой формат выбрать?

- **gzip (.gz) — быстрый, повсеместно поддерживаемый, обычно хватает для большинства задач.**
- **bzip2 (.bz2) — лучше сжатие, но медленнее, полезен для файлов, где каждый байт важен (например, большие логи, бэкапы).**
- **xz (.xz) — ещё более эффективная компрессия, но может требовать больше ресурсов (процессор/память).**
- **zip (.zip) — кроссплатформенный формат, удобен для обмена с Windows и macOS, не требует tar.**

### Примеры

1. **Сжать один файл через gzip**:
    
    ```haskell
    gzip data.csv
    ```
    
    Получаем `data.csv.gz`.
2. **Распаковать bzip2**:
    
    ```nginx
    bunzip2 backup.sql.bz2
    ```
    
    Возвращаем исходный `backup.sql`.
3. **Создать zip-архив с папкой**:
    
    ```css
    zip -r site.zip /var/www/html
    ```
    
    Рекурсивно поместит все файлы из `/var/www/html` в `site.zip`.

## Итог

- **gzip/bzip2/xz** — сжимают единичный файл, часто используются вместе с `tar` для архивации многих файлов.
- **zip/unzip** — архив + сжатие в одном формате, удобном для обмена между разными ОС.
- У каждого алгоритма **своя скорость и степень сжатия**, выбирайте под конкретную задачу.

Теперь вы умеете не только собирать файлы в архивы с помощью tar, но и понимать, как отдельно работают gzip, bzip2, xz и zip. В зависимости от того, нужно ли вам максимальное сжатие или совместимость с Windows, подбирайте соответствующий инструмент.