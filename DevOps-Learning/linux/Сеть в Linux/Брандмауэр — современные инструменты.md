Хотя **iptables** до сих пор широко используется, в современных Linux-системах появились новые, более удобные и мощные инструменты для настройки брандмауэра. В этом уроке мы рассмотрим наиболее популярные альтернативы iptables, такие как **firewalld** и **ufw**, которые значительно упрощают управление сетевой безопасностью.

### Что такое firewalld?

**firewalld** — это современный инструмент для управления сетевым экраном в системах на основе RHEL/CentOS и Fedora. Его главные преимущества:

- Поддержка динамического изменения правил без перезагрузки брандмауэра.
- Удобное управление через зоны и сервисы.
- Графические и консольные инструменты для настройки.

### Установка и активация firewalld

**CentOS/RHEL/Fedora**:

```bash
sudo yum install firewalld
sudo systemctl enable --now firewalld
```

**Debian/Ubuntu** (опционально):

```bash
sudo apt install firewalld
sudo systemctl enable --now firewalld
```

### Основные команды firewalld

- Проверка текущего состояния:

```bash
sudo firewall-cmd --state
```

- Просмотр активных зон и правил:

```bash
sudo firewall-cmd --list-all
```

- Разрешение служб (например, SSH и HTTP):

```nginx
sudo firewall-cmd --add-service=ssh --permanent
sudo firewall-cmd --add-service=http --permanent
```

- Разрешение портов напрямую:

```bash
sudo firewall-cmd --add-port=8080/tcp --permanent
```

- Перезагрузка правил для применения изменений:

```bash
sudo firewall-cmd --reload
```

### Использование зон в firewalld

firewalld позволяет использовать преднастроенные зоны безопасности, такие как:

- `public` — стандартная зона для публичных сетей.
- `trusted` — полное доверие, все соединения разрешены.
- `dmz` — для серверов, доступных из интернета с ограниченным набором разрешенных сервисов.

**Просмотр зон:**

```bash
sudo firewall-cmd --get-zones
```

**Смена зоны интерфейса:**

```bash
sudo firewall-cmd --zone=dmz --add-interface=enp0s3 --permanent
sudo firewall-cmd --reload
```

### ufw — Uncomplicated Firewall (Ubuntu/Debian)

**ufw** — это упрощённый интерфейс для управления firewall на базе iptables в Ubuntu/Debian.

#### Установка и активация ufw

```bash
sudo apt install ufw
sudo ufw enable
```

#### Основные команды ufw

- Разрешить доступ к SSH:

```bash
sudo ufw allow ssh
```

- Разрешить веб-трафик (HTTP и HTTPS):

```bash
sudo ufw allow http
sudo ufw allow https
```

- Разрешение конкретного порта:

```bash
sudo ufw allow 8080/tcp
```

- Проверка состояния и правил:

```bash
sudo ufw status verbose
```

#### Блокировка IP-адресов через ufw

Чтобы заблокировать конкретный IP-адрес:

```nginx
sudo ufw deny from 203.0.113.45
```

### nftables — современная замена iptables

**nftables** — это новая подсистема фильтрации пакетов, призванная заменить iptables. nftables обеспечивает:

- Более простую и логичную конфигурацию.
- Лучшую производительность и гибкость правил.
- Совместимость с iptables для постепенного перехода.

#### Пример настройки простого правила в nftables

Установка nftables:

- Debian/Ubuntu:

```bash
sudo apt install nftables
sudo systemctl enable --now nftables
```

Пример простых правил в `/etc/nftables.conf`:

```python
table inet filter {
    chain input {
        type filter hook input priority 0; policy drop;
        
        ct state established,related accept
        iif lo accept
        tcp dport {22, 80, 443} accept
    }

    chain forward {
        type filter hook forward priority 0; policy drop;
    }

    chain output {
        type filter hook output priority 0; policy accept;
    }
}
```

Применить правила:

```bash
sudo nft -f /etc/nftables.conf
```

### Какой инструмент выбрать?

- **firewalld** — подходит для RHEL/CentOS и тех, кому важна динамическая конфигурация и простое управление зонами.
- **ufw** — идеально для Ubuntu/Debian, особенно если нужно простое и интуитивное управление.
- **nftables** — для новых проектов и систем, где важна высокая производительность и гибкость.

## Итоги

- Современные инструменты управления брандмауэром (firewalld, ufw, nftables) значительно упрощают конфигурацию и обслуживание firewall.
- **firewalld** удобен для динамического управления правилами и зонами.
- **ufw** — идеальный выбор для простоты и скорости настройки firewall на Ubuntu/Debian.
- **nftables** — современная замена iptables, подходящая для сложных конфигураций и новых проектов.

Используя современные инструменты firewall, вы значительно повысите безопасность и упростите управление защитой вашей сети.