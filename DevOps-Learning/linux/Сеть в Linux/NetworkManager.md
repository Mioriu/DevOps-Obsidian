В современных дистрибутивах Linux традиционные методы настройки сети через конфигурационные файлы постепенно уступают место более удобному и интуитивному решению — NetworkManager. Давайте разберемся, что это за инструмент и почему он стал стандартом в управлении сетью.

### Роль NetworkManager в современных дистрибутивах

Представьте обычную ситуацию: вы работаете на ноутбуке, перемещаетесь между домом, офисом и кафе с Wi-Fi. В каждом месте — разные настройки сети. Раньше вам пришлось бы вручную редактировать конфигурационные файлы или создавать скрипты для каждого места. NetworkManager решает эту проблему, автоматически определяя и подключаясь к доступным сетям.

По своей сути, NetworkManager — это демон (фоновая служба), который:

- Автоматически обнаруживает доступные проводные и беспроводные сети
- Запоминает настройки для разных сетей
- Переключается между соединениями без ручного вмешательства
- Предоставляет удобный интерфейс для настройки всех типов подключений

Сегодня NetworkManager — стандартный компонент в Ubuntu, Fedora, Debian, CentOS и многих других дистрибутивах. Он работает как на десктопах, так и на серверах, где требуется гибкое управление сетью.

### Преимущества использования NetworkManager

Почему стоит использовать NetworkManager вместо традиционных способов настройки сети?

**1. Удобство для пользователя**

Вместо ручного редактирования конфигурационных файлов вы получаете:

- Наглядный индикатор состояния сети в системном трее
- Простой выбор Wi-Fi сетей из списка
- Автоматическое подключение к известным сетям
- Интуитивно понятные меню настройки

**2. Динамическое управление**

NetworkManager реагирует на изменения в реальном времени:

- Подключил Ethernet-кабель? Система автоматически переключится с Wi-Fi на проводное соединение
- Отключил кабель? Система вернется к использованию Wi-Fi
- Перешел в зону действия известной Wi-Fi сети? Подключение произойдет автоматически

**3. Поддержка различных типов сетей**

NetworkManager работает не только с базовыми типами подключений:

- Проводные и беспроводные сети
- Мобильный интернет (3G/4G/5G)
- VPN-соединения различных типов
- VLAN, мосты, связанные интерфейсы
- PPPoE для DSL-подключений

**4. Управление несколькими соединениями**

Когда у вас есть несколько вариантов подключения, NetworkManager:

- Выбирает наилучшее соединение по приоритету
- Поддерживает резервное копирование (failover) между соединениями
- Позволяет легко переключаться между разными профилями

### Структура конфигурационных файлов NetworkManager

Хотя один из плюсов NetworkManager — это возможность настройки без редактирования файлов, полезно понимать, где и как хранятся настройки.

Основные файлы и директории:

- **/etc/NetworkManager/NetworkManager.conf** — главный конфигурационный файл с общими настройками
- **/etc/NetworkManager/system-connections/** — здесь хранятся настройки для каждого соединения в отдельных файлах (доступны только для root)
- **/var/lib/NetworkManager/** — кеш и служебная информация

Например, файл профиля Wi-Fi соединения может выглядеть так:

```ini
[connection]
id=HomeWiFi
type=wifi

[wifi]
ssid=MyHomeNetwork
mode=infrastructure

[wifi-security]
key-mgmt=wpa-psk
psk=mypassword

[ipv4]
method=auto

[ipv6]
method=auto
```

Это файл в формате INI с понятными секциями: общие настройки соединения, специфические настройки Wi-Fi, параметры безопасности и конфигурация IP.

В отличие от традиционных конфигурационных файлов, редактировать эти файлы вручную обычно не требуется — NetworkManager предоставляет удобные инструменты для управления.

### Интерфейс командной строки для NetworkManager (nmcli)

Для сисадминов, любителей терминала или управления через SSH NetworkManager предлагает мощную утилиту командной строки — `nmcli`.

Рассмотрим наиболее полезные сценарии использования:

**Проверка состояния сети**

Чтобы быстро узнать, какие устройства есть в системе и их статус:

```lua
nmcli device status
```

Этот простой запрос покажет вам список всех сетевых интерфейсов (Ethernet, Wi-Fi, виртуальные), их состояние (подключено, отключено) и с каким соединением они связаны. Это замена старой команды `ifconfig`, но с более читаемым выводом.

**Управление Wi-Fi**

Например, чтобы увидеть доступные Wi-Fi сети вокруг, как это делает смартфон:

```nginx
nmcli device wifi list
```

Эта команда покажет список всех Wi-Fi сетей в зоне действия, включая имя сети (SSID), силу сигнала и тип защиты. Это гораздо удобнее, чем использовать сложные команды `iwlist scanning`.

Если вы хотите подключиться к Wi-Fi, просто укажите имя сети и пароль:

```perl
nmcli device wifi connect "MyWiFi" password "mypassword"
```

NetworkManager запомнит эти настройки, и в следующий раз подключится автоматически, когда обнаружит эту сеть.

**Создание новых подключений**

Допустим, вам нужно настроить статический IP для сервера. Вместо редактирования конфигурационных файлов можно использовать:

```nginx
nmcli connection add type ethernet con-name "Server LAN" ifname eth0 ipv4.method manual ipv4.addresses 192.168.1.100/24 ipv4.gateway 192.168.1.1 ipv4.dns "8.8.8.8"
```

Эта команда создает новый профиль подключения с заданными параметрами. Длинная строка, но она заменяет редактирование нескольких конфигурационных файлов и перезапуск служб.

### Графические интерфейсы для NetworkManager

Не все пользователи Linux комфортно чувствуют себя в командной строке. NetworkManager предлагает несколько графических интерфейсов:

#### 1. nmtui (NetworkManager Text User Interface)

Это псевдографический интерфейс в терминале — нечто среднее между командной строкой и полноценным GUI. Запустите `nmtui` в терминале, и вы увидите простое навигационное меню, где можно:

- Редактировать соединения
- Активировать/деактивировать соединения
- Изменять имя хоста

Это особенно полезно на серверах без графического интерфейса или через SSH-соединение, когда полноценный GUI недоступен.

#### 2. Апплеты рабочего стола

Если вы используете графическую среду, NetworkManager представлен значком в системном трее, который показывает состояние сети и предлагает меню для быстрого управления:

- В GNOME — встроенная интеграция в панели управления
- В KDE — плазмоид для управления сетью
- В других средах — обычно используется универсальный nm-applet

Через эти апплеты можно быстро выбрать Wi-Fi сеть, подключиться к VPN или проверить текущее соединение.

#### 3. Расширенные настройки

Для более сложных настроек есть специальные инструменты:

- `nm-connection-editor` — редактор профилей с расширенными настройками
- Сетевые настройки в системных настройках GNOME или KDE

Эти инструменты позволяют настраивать любые параметры сети через понятный графический интерфейс без необходимости знать синтаксис конфигурационных файлов.

### Профили подключений и их настройка

Центральная концепция в NetworkManager — профиль подключения. Это набор настроек для определенной сети, который можно активировать при необходимости.

**Зачем нужны профили?**

Представьте ситуации:

- Дома у вас динамический IP через DHCP
- В офисе нужен статический IP с определенными настройками DNS
- В гостевой сети компании требуется автоматическое подключение к VPN

Вместо ручного изменения настроек каждый раз, вы создаете отдельные профили для каждой среды. NetworkManager автоматически активирует нужный профиль при обнаружении соответствующей сети.

**Что включает в себя профиль?**

Профиль может содержать:

- Базовые настройки: имя профиля, тип соединения, интерфейс
- Настройки IP: статический/динамический, адрес, маска, шлюз
- Настройки DNS: серверы, домены поиска
- Специфические настройки: для Wi-Fi — имя сети, пароль; для VPN — параметры сервера
- Параметры безопасности: типы шифрования, сертификаты
- Дополнительные настройки: маршруты, метрики, MAC-адреса

**Примеры использования профилей**

Например, вы можете иметь:

- "Дом" — профиль для домашней Wi-Fi сети
- "Офис проводной" — для подключения к офисной сети через Ethernet
- "Командировка" — профиль, который автоматически запускает VPN при подключении к публичным Wi-Fi

Профили можно создавать, изменять и удалять через любой из интерфейсов NetworkManager: графический, nmtui или nmcli.

### Управление соединениями

NetworkManager предоставляет простые способы управления жизненным циклом соединений.

**Создание соединений**

Вы можете создать новый профиль для различных типов сетей:

- Ethernet — для проводных подключений
- Wi-Fi — для беспроводных сетей
- VPN — для защищенных туннелей (OpenVPN, WireGuard и др.)
- Мобильный — для 3G/4G модемов
- VLAN — для виртуальных локальных сетей
- Bridge — для соединения нескольких интерфейсов

При создании профиля вы указываете необходимые параметры, и NetworkManager сохраняет их для будущего использования.

**Активация и деактивация**

Когда профили созданы, вы можете:

- Вручную включить или выключить конкретное соединение
- Настроить автоматическую активацию при обнаружении сети
- Установить приоритеты для автоматического выбора

Например, если у вас есть и Ethernet, и Wi-Fi подключение, NetworkManager по умолчанию отдаст предпочтение проводному соединению как более надежному.

**Изменение соединений**

Со временем параметры сети могут меняться:

- Изменился пароль Wi-Fi
- Нужно добавить новый DNS-сервер
- Требуется отключить IPv6

Все эти изменения можно внести в существующий профиль без необходимости создавать новый.

### Интеграция с другими сетевыми сервисами

NetworkManager не работает изолированно, а взаимодействует с другими компонентами системы.

**Управление DNS**

При подключении к сети NetworkManager обновляет DNS-настройки системы:

- Обновляет `/etc/resolv.conf` с DNS-серверами, полученными от DHCP или указанными вручную
- Интегрируется с локальными DNS-серверами (dnsmasq, systemd-resolved)
- Поддерживает поиск по нескольким доменам для корпоративных сред

Это избавляет вас от необходимости вручную обновлять DNS-настройки при смене сети.

**VPN-интеграция**

NetworkManager поддерживает различные типы VPN через систему плагинов:

- OpenVPN, WireGuard для общего использования
- Cisco AnyConnect, Fortinet для корпоративных VPN
- L2TP/IPsec, PPTP для специфических сценариев

Это позволяет управлять VPN-соединениями так же легко, как обычными сетевыми подключениями — через тот же интерфейс.

**Интеграция с системой безопасности**

NetworkManager безопасно хранит чувствительную информацию:

- Пароли Wi-Fi и VPN сохраняются в защищенных хранилищах (GNOME Keyring, KWallet)
- Права доступа к конфигурационным файлам ограничены
- Поддерживается аутентификация через сертификаты и 802.1x для корпоративных сетей

**Обработка событий**

NetworkManager может выполнять действия при изменении состояния сети:

- Запускать скрипты при подключении или отключении
- Интегрироваться с брандмауэром для изменения правил в зависимости от сети
- Уведомлять другие приложения об изменениях сетевого статуса

Например, можно настроить автоматический запуск VPN при подключении к публичной Wi-Fi сети или монтирование сетевых дисков при подключении к офисной сети.