**DNS (Domain Name System)** — одна из ключевых технологий интернета, преобразующая имена доменов в IP-адреса. Linux-администратор должен понимать, как работает DNS-резолвинг, какие файлы управляют DNS-настройками и какие инструменты помогают диагностировать проблемы с доменными именами.

### Как работает DNS?

DNS отвечает за преобразование доменных имён (например, `example.com`) в IP-адреса (например, `93.184.216.34`).

Процесс резолвинга (разрешения имён) выглядит так:

- Пользователь вводит имя сайта в браузере.
- Компьютер обращается к DNS-серверу (например, 8.8.8.8 — Google DNS).
- DNS-сервер возвращает IP-адрес сайта.
- Браузер соединяется с этим IP-адресом и получает страницу.

### Настройки DNS в Linux: `/etc/resolv.conf`

Основной файл DNS-настроек в Linux — `/etc/resolv.conf`. Пример содержимого:

```nginx
nameserver 8.8.8.8
nameserver 8.8.4.4
search mydomain.local
```

- `nameserver` — DNS-серверы, которые используются системой.
- `search` — домены, автоматически добавляемые к коротким именам.

Часто этот файл генерируется автоматически утилитами **NetworkManager** или **systemd-resolved**.

### Проверка DNS-резолвинга: `nslookup` и `dig`

Для проверки DNS и диагностики используется `nslookup` или `dig`.

**Пример использования `nslookup`:**

```nginx
nslookup example.com
```

Ответ должен выглядеть так:

```yaml
Server:     8.8.8.8
Address:    8.8.8.8#53

Non-authoritative answer:
Name:   example.com
Address: 93.184.216.34
```

**Пример использования `dig` (более подробно):**

```nginx
dig example.com
```

Dig выводит больше информации, в том числе время ответа, авторитетность сервера и TTL записи.

### Локальное разрешение имён: `/etc/hosts`

Файл `/etc/hosts` используется для статического локального резолвинга без DNS-запросов.

Пример файла:

```lua
127.0.0.1       localhost
192.168.1.10    myhost myhost.local
192.168.1.20    fileserver fileserver.local
```

Это позволяет обращаться к узлам по именам без использования DNS-сервера:

```dos
ping fileserver
```

### Кэширование DNS-запросов в Linux

Для ускорения резолвинга многие системы используют локальный DNS-кэш:

- **systemd-resolved** (современные Ubuntu, Debian):

Проверка кэша DNS:

```lua
resolvectl status
```

Очистка кэша:

```bash
sudo systemd-resolve --flush-caches
```

- **dnsmasq** (лёгкий DNS-кэширующий сервер):

Установка dnsmasq (Debian/Ubuntu):

```bash
sudo apt install dnsmasq
```

Очистка кэша dnsmasq:

```bash
sudo systemctl restart dnsmasq
```

### Диагностика проблем DNS

При возникновении проблем с DNS сделайте следующее:

- Проверьте доступность DNS-серверов (например, через `ping 8.8.8.8`).
- Используйте `dig +trace` для диагностики полного пути резолвинга:

```nginx
dig +trace example.com
```

- Проверьте лог системных сообщений (например, `/var/log/syslog`):

```css
grep -i dns /var/log/syslog
```

### Изменение DNS-серверов в NetworkManager

Чтобы изменить DNS-сервера постоянно через NetworkManager, выполните:

```nginx
nmcli connection modify "Wired connection 1" ipv4.dns "8.8.8.8,8.8.4.4"
nmcli connection modify "Wired connection 1" ipv4.ignore-auto-dns yes
nmcli connection up "Wired connection 1"
```

- Замените `"Wired connection 1"` на имя вашего подключения.

### Использование публичных DNS-серверов

Часто используются публичные DNS-сервера, которые быстро отвечают и редко бывают недоступны:

- Google DNS: `8.8.8.8`, `8.8.4.4`
- Cloudflare DNS: `1.1.1.1`, `1.0.0.1`
- OpenDNS: `208.67.222.222`, `208.67.220.220`

## Итоги

- DNS преобразует доменные имена в IP-адреса и является важнейшей сетевой службой.
- Файл `/etc/resolv.conf` содержит DNS-настройки системы.
- Для проверки DNS используются инструменты `nslookup` и `dig`.
- Файл `/etc/hosts` служит для локального разрешения имён.
- Кэш DNS ускоряет работу и снижает нагрузку на DNS-серверы.
- Использование публичных DNS-серверов повышает надёжность и скорость резолвинга.

Эти знания помогут вам эффективно управлять и диагностировать DNS в Linux, обеспечивая бесперебойную работу сети и приложений.