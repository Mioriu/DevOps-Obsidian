## Конфигурация сетевых интерфейсов - базовая настройка

В этом уроке мы разберём, как в Linux настраиваются сетевые интерфейсы: от их просмотра до базовой конфигурации IP-адресов и маршрутизации.

### Типы сетевых интерфейсов в Linux

В зависимости от дистрибутива, оборудования и способа его обнаружения, сетевые интерфейсы в Linux могут иметь различные имена:

|Тип имени|Примеры|Описание|
|---|---|---|
|**Традиционные**|eth0, eth1, wlan0|Исторические имена, используемые в старых дистрибутивах. Ненадёжны при замене оборудования.|
|**Предсказуемые**  <br>(systemd, udev)|enp0s3, wlp2s0|Современная схема именования, где:  <br>en = ethernet, wl = wireless  <br>p0s3 = шина/слот/порт|
|**Специальные**|lo, tun0, docker0|Виртуальные интерфейсы для особых целей:  <br>lo = loopback (127.0.0.1)  <br>tun = туннели  <br>br = мосты|

> ### Как читать имя интерфейса
> 
> - **lo** — loopback, всегда есть (127.0.0.1).
>     
> - **enp0s3 / wlp2s0** — предсказуемые имена: **en**=Ethernet, **wl**=Wi-Fi; дальше шина/слот/порт.
>     
> - **br0 / tun0 / docker0** — мосты, туннели, виртуальные интерфейсы.
>     

### Знакомство с командой ip

Современное управление сетью в Linux осуществляется с помощью утилиты `ip` из пакета `iproute2`. Эта команда позволяет управлять практически всеми аспектами сетевой подсистемы:

|Подкоманда|Назначение|Примеры|
|---|---|---|
|`ip link`|Управление сетевыми интерфейсами|`ip link show`  <br>`ip link set eth0 up`|
|`ip addr`|Управление IP-адресами|`ip addr show`  <br>`ip addr add 192.168.1.10/24 dev eth0`|
|`ip route`|Управление маршрутизацией|`ip route show`  <br>`ip route add default via 192.168.1.1`|
|`ip neigh`|Управление ARP-таблицей|`ip neigh show`|

**Примечание:** Старая утилита `ifconfig` по-прежнему доступна во многих дистрибутивах, но считается устаревшей (legacy). Новые функции сетевого стека Linux не всегда корректно отображаются в `ifconfig`.

### Просмотр сетевых интерфейсов

Для просмотра всех имеющихся в системе сетевых интерфейсов используется команда:

```bash
ip link show
```

Примерный вывод:

```sql
1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN mode DEFAULT group default 
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
2: enp0s3: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc fq_codel state UP mode DEFAULT group default qlen 1000
    link/ether 08:00:27:c3:54:7a brd ff:ff:ff:ff:ff:ff
```

В этом выводе мы видим:

- **lo** — локальный интерфейс для внутренних соединений
- **enp0s3** — физический сетевой интерфейс
- **<BROADCAST,MULTICAST,UP,LOWER_UP>** — флаги, описывающие состояние и возможности
- **state UP** — интерфейс включен и готов к работе
- **link/ether 08:00:27:c3:54:7a** — MAC-адрес интерфейса

Эквивалент через устаревшую команду `ifconfig`:

```css
ifconfig -a
```

### Просмотр IP-адресов

Для просмотра IP-адресов, назначенных интерфейсам, используется команда:

```sql
ip addr show
```

Или для конкретного интерфейса:

```sql
ip addr show dev enp0s3
```

Примерный вывод:

```sql
2: enp0s3: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc fq_codel state UP group default qlen 1000
    link/ether 08:00:27:c3:54:7a brd ff:ff:ff:ff:ff:ff
    inet 192.168.1.100/24 brd 192.168.1.255 scope global enp0s3
       valid_lft forever preferred_lft forever
    inet6 fe80::a00:27ff:fec3:547a/64 scope link 
       valid_lft forever preferred_lft forever
```

В этом выводе:

- **inet 192.168.1.100/24** — IPv4-адрес и маска подсети в формате CIDR
- **brd 192.168.1.255** — широковещательный (broadcast) адрес
- **scope global** — область видимости адреса (global = может использоваться для связи с другими сетями)
- **inet6 fe80::** — автоматически назначенный IPv6-адрес

### Управление состоянием интерфейса (включение/выключение)

Чтобы включить (поднять) сетевой интерфейс:

```bash
ip link set dev enp0s3 up
```

Чтобы выключить (опустить) интерфейс:

```bash
ip link set dev enp0s3 down
```

**Важно:** Для управления сетевыми интерфейсами обычно требуются права root. Используйте `sudo` перед командами, если вы не работаете под пользователем root.

### Временная настройка IP-адреса

Чтобы временно (до перезагрузки) назначить IP-адрес интерфейсу:

```nginx
ip addr add 192.168.1.100/24 dev enp0s3
```

Здесь:

- **192.168.1.100** — назначаемый IP-адрес
- **/24** — маска подсети (соответствует 255.255.255.0)
- **dev enp0s3** — интерфейс, которому назначается адрес

Чтобы добавить ещё один IP-адрес на тот же интерфейс (несколько IP на одной карте):

```nginx
ip addr add 192.168.1.101/24 dev enp0s3
```

Для удаления IP-адреса с интерфейса:

```nginx
ip addr del 192.168.1.100/24 dev enp0s3
```

### Настройка маршрутизации

Для просмотра текущей таблицы маршрутизации:

```sql
ip route show
```

Примерный вывод:

```nginx
default via 192.168.1.1 dev enp0s3 proto dhcp src 192.168.1.100 metric 100 
192.168.1.0/24 dev enp0s3 proto kernel scope link src 192.168.1.100 
192.168.122.0/24 dev virbr0 proto kernel scope link src 192.168.122.1
```

Чтобы добавить маршрут по умолчанию (default gateway):

```x86asm
ip route add default via 192.168.1.1 dev enp0s3
```

Для добавления маршрута к конкретной сети:

```nginx
ip route add 10.0.0.0/8 via 192.168.1.254 dev enp0s3
```

Этот маршрут говорит: "для доступа к сети 10.0.0.0/8 отправляй пакеты через шлюз 192.168.1.254".

Для удаления маршрута:

```nginx
ip route del 10.0.0.0/8
```

### Сравнение команд ip и ifconfig

|Задача|Команда ip (рекомендуется)|Команда ifconfig (устаревшая)|
|---|---|---|
|Просмотр интерфейсов|`ip link show`|`ifconfig -a`|
|Просмотр IP|`ip addr show`|`ifconfig`|
|Включение интерфейса|`ip link set dev eth0 up`|`ifconfig eth0 up`|
|Задание IP|`ip addr add 192.168.1.100/24 dev eth0`|`ifconfig eth0 192.168.1.100 netmask 255.255.255.0`|
|Просмотр маршрутов|`ip route show`|`route -n`|
|Добавление маршрута|`ip route add 10.0.0.0/8 via 192.168.1.1`|`route add -net 10.0.0.0/8 gw 192.168.1.1`|

**Совет:** Используйте опцию `-c` с командой `ip`, чтобы получить цветной вывод для лучшей читаемости: `ip -c addr show`.

### Проверка настроенного соединения

После настройки сети важно проверить работоспособность соединения:

1. Проверка локального интерфейса: `ping -c 4 127.0.0.1`
2. Проверка локальной сети: `ping -c 4 192.168.1.1` (подставьте адрес вашего шлюза)
3. Проверка интернета: `ping -c 4 8.8.8.8`
4. Проверка DNS: `ping -c 4 google.com`

> **⚠️ Не путайте:**
> 
> - **Порты** — это уровень **TCP/UDP**, к IP/маршрутам не относятся.
>     
> - **MAC/MTU/состояние (UP/DOWN)** смотрим в `ip link show`; **IP/broadcast** — в `ip addr show`.
>     
> - **Default route** — это запись в `ip route`; для удаления используем `ip route del default`.
>     

После базового знакомства с настройкой сетевых интерфейсов, в следующем уроке мы перейдём к более сложным аспектам конфигурации сети и постоянной настройке через конфигурационные файлы.