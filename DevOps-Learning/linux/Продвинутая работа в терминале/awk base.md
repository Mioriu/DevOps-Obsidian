## ![](https://ucarecdn.stepik.net/a58f14c3-0a8f-42eb-b953-7b003a5bd66c/)

## Утилита awk — основы

**awk** — это мощная утилита для обработки и анализа текстовых данных в Linux. Она идеально подходит для быстрого извлечения, фильтрации, форматирования и трансформации данных из текстовых файлов и вывода команд.

awk часто используется в сценариях автоматизации и является неотъемлемым инструментом для системных администраторов, программистов и аналитиков.

### Как работает awk?

awk обрабатывает текст **построчно**. Каждая строка разбивается на **поля** (столбцы). По умолчанию разделителем является пробел или табуляция.  
`$1`, `$2`, `$3` … — это столбцы, а `$0` — вся строка целиком.

Синтаксис команды awk выглядит так:

```1c
awk 'условие {действие}' файл
```

- **условие** — позволяет фильтровать строки, с которыми нужно работать.
- **действие** — описывает, что именно нужно сделать с отфильтрованными строками.

### Простой пример работы awk

Допустим, есть файл `users.txt` с таким содержимым:

```nginx
Ivanov Ivan 32
Petrova Anna 25
Sidorov Alexey 29
```

Здесь мы используем `$1`, чтобы вывести только первое поле (фамилия).

```nginx
awk '{print $1}' users.txt
```

Результат:

```nginx
Ivanov
Petrova
Sidorov
```

### Основные возможности awk

#### Выбор полей

- `$1, $2, $3...` — обозначения полей в строке
- `$0` — вся строка целиком

Выведем только имя и возраст (2-е и 3-е поля):

```nginx
awk '{print $2, $3}' users.txt
```

Получим:

```nginx
Ivan 32
Anna 25
Alexey 29
```

#### Фильтрация по условию

В awk условие записывается прямо перед `{print ...}`.  
В примере `$3 > 30` означает «выбрать только те строки, где значение в третьем поле больше 30».

Вывести строки, где возраст (3-е поле) больше 30:

```nginx
awk '$3 > 30 {print $0}' users.txt
```

Вывод:

```nginx
Ivanov Ivan 32
```

### Разделитель полей

По умолчанию awk использует пробел или табуляцию для разделения строк на поля. Чтобы использовать другой разделитель, применяется опция `-F`:

Если файл `data.csv` выглядит так:

```undefined
Ivanov,Ivan,32
Petrova,Anna,25
```

Вывод второго поля с разделителем запятой:

```nginx
awk -F',' '{print $2}' data.csv
```

> Опция `-F` всегда указывается перед фигурными скобками. Например:
> 
> `awk -F"," '{print $2}' data.csv`

Результат:

```nginx
Ivan
Anna
```

### Встроенные переменные awk

- `NR` — номер текущей строки
- `NF` — количество полей в текущей строке
- `FS` — текущий разделитель полей (по умолчанию пробел)
- `OFS` — разделитель при выводе (по умолчанию пробел)

Эти переменные часто используются для подсчётов и анализа текста. Например:

- `NR` помогает посчитать строки (`END {print NR}`)
    
- `sum += $3; END {print sum/NR}` позволяет вычислить среднее значение
    

Выведем номер строки и количество полей:

```makefile
awk '{print "Строка №" NR, "- полей:", NF}' users.txt
```

Получим:

```1c
Строка №1 - полей: 3
Строка №2 - полей: 3
Строка №3 - полей: 3
```

### Использование регулярных выражений в awk

awk поддерживает регулярные выражения для фильтрации строк. Например, выведем строки, где встречается фамилия «Ivanov»:

```nginx
awk '/Ivanov/ {print $0}' users.txt
```

Чтобы исключить строки, используйте оператор `!~`.

```nginx
awk '$1 !~ /Petrova/' users.txt
```

Или с отрицанием (вывести строки без «Petrova»):

```nginx
awk '!/Petrova/ {print $0}' users.txt
```

### Форматирование вывода

Можно задать формат вывода с помощью `printf`, аналогично языку C:

```swift
awk '{printf "%-10s %-10s %3d\n", $1, $2, $3}' users.txt
```

Это создаст красивый вывод:

```nginx
Ivanov     Ivan        32
Petrova    Anna        25
Sidorov    Alexey      29
```

### Использование awk в конвейерах

Часто awk используется совместно с другими командами через конвейер (`|`):

```nginx
ps aux | awk '$1=="root" { print $2, $11 }'
```

Эта команда выводит только процессы пользователя root, показывая PID и команду.

## Краткая шпаргалка по основам awk

- `{print $1, $3}` — вывести поля 1 и 3
- `$3 > 20` — строки с третьим полем больше 20
- `NR` — номер строки
- `NF` — количество полей в строке
- `-F","` — задать разделитель полей (например, запятую)
- `/pattern/` — строки, содержащие шаблон

## Итог

**awk** — мощный инструмент, идеально подходящий для быстрой обработки и анализа текстовых данных. Даже базовые знания awk позволяют легко решать многие задачи извлечения и форматирования информации. В следующем уроке мы закрепим эти знания на практике и изучим более продвинутые возможности awk.

> **Мини-шпаргалка**:
> 
> Часто используемые конструкции awk:  
> - {print 1,1,3} — вывести поля 1 и 3  
> - $3 > 20 — строки, где 3-е поле больше 20  
> - NR — номер строки  
> - NF — количество полей  
> - -F"," — задать разделитель «запятая»  
> - /pattern/ — строки, содержащие шаблон  
> - $1 !~ /text/ — строки, где 1-е поле не содержит шаблон  
> - sum += $3; END {print sum/NR} — посчитать среднее значение по 3-му полю  
>