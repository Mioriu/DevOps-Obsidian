## ![](https://ucarecdn.stepik.net/c5b18f75-eba9-47fc-8b9e-a0ee9bce1285/)

## Сортировка и уникальность данных

При работе с текстовыми данными в Linux часто возникает необходимость сортировать строки, удалять дубликаты и проверять уникальность записей. Для таких задач используются две простые, но мощные утилиты:

- **sort** — сортирует строки в файлах или потоках по различным критериям
- **uniq** — удаляет или подсчитывает повторяющиеся строки

Эти команды особенно полезны при анализе логов, обработке списков данных и автоматизации различных задач.

### Команда sort — основы сортировки

По умолчанию `sort` сортирует строки в алфавитном порядке (по возрастанию):

> Если в строках содержатся числа, `sort` по умолчанию сравнивает их как текст. Поэтому числа будут отсортированы так: 1, 10, 2, 20… Чтобы сортировать **по значению числа**, используйте флаг `-n`. Для убывающего порядка комбинируйте `-n` и `-r`.

```bash
sort fruits.txt
```

Если `fruits.txt` содержит:

```nginx
Banana
Apple
Kiwi
Orange
```

Вывод будет:

```nginx
Apple
Banana
Kiwi
Orange
```

### Опции команды sort

- `-r` — сортировка в обратном порядке (по убыванию)
- `-n` — сортировка по числовым значениям
- `-k` — сортировка по определённому столбцу
- `-t` — задать разделитель столбцов
- `-u` — удалить дубликаты во время сортировки
- `-f` — игнорировать регистр букв при сортировке
    

**Примеры использования опций:**

#### Сортировка чисел

Файл `numbers.txt`:

```undefined
10
2
100
50
```

Числовая сортировка:

```bash
sort -n numbers.txt
```

Результат:

```undefined
2
10
50
100
```

#### Сортировка в обратном порядке

```bash
sort -nr numbers.txt
```

Результат:

```undefined
100
50
10
2
```

#### Сортировка по столбцу

Если у вас файл `users.txt`:

```nginx
Ivanov Ivan 30
Petrova Anna 25
Sidorov Alexey 29
```

Отсортируем по возрасту (3-й столбец):

```bash
sort -k3 -n users.txt
```

Здесь `-k3` указывает третий столбец, а `-n` говорит сортировать как числа. Если бы мы написали просто `sort -k3`, сортировка была бы текстовой: например, 100 шло бы раньше 20.

Вывод:

```nginx
Petrova Anna 25
Sidorov Alexey 29
Ivanov Ivan 30
```

### Команда uniq — работа с уникальностью строк

Чтобы `uniq` работала правильно, данные должны быть предварительно отсортированы. Если строки не отсортировать, `uniq` уберёт только подряд идущие повторы, а остальные оставит. Поэтому почти всегда пишут:

```bash
sort file.txt | uniq
```

**Важно:** uniq удаляет только идущие подряд дубликаты, поэтому данные должны быть предварительно отсортированы.

#### Удаление дубликатов

Файл `fruits.txt`:

```nginx
Apple
Apple
Banana
Banana
Kiwi
```

Удалим дубликаты:

```bash
sort fruits.txt | uniq
```

Результат:

```nginx
Apple
Banana
Kiwi
```

#### Подсчёт количества повторений (-c)

```bash
sort fruits.txt | uniq -c
```

Вывод:

```markdown
      2 Apple
      2 Banana
      1 Kiwi
```

#### Вывод только повторяющихся или уникальных строк

- `uniq -d` — выводит только повторяющиеся строки
- `uniq -u` — выводит только уникальные строки (без повторов)

Пример вывода повторов:

```bash
sort fruits.txt | uniq -d
```

Результат:

```nginx
Apple
Banana
```

Вывод уникальных строк (без повторений):

```bash
sort fruits.txt | uniq -u
```

Результат:

```nginx
Kiwi
```

### Комбинирование sort и uniq

Обычно sort и uniq используются вместе для выполнения эффективных операций:

- Подсчёт повторов:

```bash
sort data.txt | uniq -c | sort -nr
```

Это покажет наиболее частые строки вверху.

### Практическое применение

#### Анализ лог-файлов

Подсчитаем, сколько раз встречается каждый IP-адрес в веб-логе `access.log` (предположим, IP — первое поле):

```bash
awk '{print $1}' access.log | sort | uniq -c | sort -nr | head -10
```

Результат — список самых активных IP-адресов:

```markdown
    250 192.168.0.1
    120 10.0.0.1
     97 172.16.0.2
```

### Краткая шпаргалка по sort и uniq

- `sort -n` — сортировка чисел
- `sort -r` — сортировка в обратном порядке
- `sort -k2` — сортировка по второму столбцу
- `uniq -d` показывает только повторяющиеся строки.
- `uniq -u` показывает только те строки, которые встречаются ровно один раз.
- `uniq -c` показывает каждую строку и сколько раз она встретилась.

## Итог

Команды **sort** и **uniq** предоставляют удобные и простые способы организовать и обрабатывать текстовые данные. Освоив их, вы сможете быстро решать задачи анализа данных, удаления дубликатов, подсчёта повторов и подготовки данных для дальнейшей обработки.

- `sort -nr file` — сортировка чисел по убыванию
    
- `sort -f file` — сортировка без учёта регистра
    

В следующем уроке мы потренируемся использовать эти утилиты на реальных примерах.