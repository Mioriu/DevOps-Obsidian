## ![](https://ucarecdn.stepik.net/abf82af5-a6c9-499b-aa93-ca77299793e2/)

## Сравнение файлов

При работе с файлами в Linux часто возникает необходимость сравнить их содержимое. Например, проверить, отличаются ли конфигурационные файлы, посмотреть, что изменилось между двумя версиями документа или исходного кода, либо просто убедиться, что резервная копия совпадает с оригиналом.

Для этого Linux предлагает несколько простых и удобных инструментов:

- **diff** — классическая утилита для детального сравнения файлов
- **comm** — сравнивает два отсортированных файла построчно
- **cmp** — простое и быстрое побайтовое сравнение

### 1. Команда diff — детальное сравнение файлов

Утилита **diff** является наиболее распространённым инструментом для сравнения файлов. Она показывает разницу в содержимом двух файлов, построчно указывая добавления, удаления и изменения.

#### Синтаксис команды:

```nginx
diff file1.txt file2.txt
```

#### Пример использования diff

Есть два файла:

`version1.txt`:

```nginx
apple
banana
orange
kiwi
```

`version2.txt`:

```nginx
apple
banana
grape
kiwi
```

Сравним их:

```nginx
diff version1.txt version2.txt
```

#### Вывод команды:

```yaml
3c3
< orange
---
> grape
```

**Как читать вывод diff:**

- `3c3` означает, что строка №3 была изменена (`c` — change).
- `<` показывает строку из первого файла, а `>` из второго.

#### Ключевые опции diff:

- `-u` (unified diff) — показывает вывод в более понятном, унифицированном виде, часто используется для патчей.
- `-y` (side-by-side) — выводит различия в виде двух колонок.
- `-q` (quiet) — краткий вывод, просто сообщает, отличаются файлы или нет.
- `-r` (recursive) — рекурсивно сравнивает содержимое каталогов.
- `-y` (side-by-side) — выводит различия в две колонки. 

#### Унифицированный формат вывода (diff -u)

```nginx
diff -u version1.txt version2.txt
```

Результат:

```diff
--- version1.txt  2024-04-05 12:00:00
+++ version2.txt  2024-04-05 12:05:00
@@ -1,4 +1,4 @@
 apple
 banana
-orange
+grape
 kiwi
```

- Строки с `-` удалены, с `+` добавлены.

### 2. Команда comm — построчное сравнение отсортированных файлов

Утилита `comm` удобна, когда файлы предварительно отсортированы. Она показывает три колонки:

- Строки, которые есть только в первом файле
- Строки, которые есть только во втором файле
- Строки, которые есть в обоих файлах

#### Пример использования comm

Отсортируем и сравним файлы:

```bash
sort file1.txt > sorted1.txt
sort file2.txt > sorted2.txt
comm sorted1.txt sorted2.txt
```

#### Вывод:

```markdown
        apple
        banana
orange
        grape
        kiwi
```

В выводе первая колонка — строки только из первого файла, вторая — только из второго, третья — общие.

#### Полезные опции comm:

- `-1` — не выводить первую колонку
- `-2` — не выводить вторую колонку
- `-3` — не выводить третью колонку (общие строки)

### 3. Команда cmp — быстрое побайтовое сравнение

**cmp** — быстрая команда, которая проверяет, отличаются ли два файла. Она прекращает работу сразу после обнаружения первого различия и сообщает его местоположение (номер строки и байта).

#### Пример использования cmp:

```nginx
cmp file1.txt file2.txt
```

#### Пример вывода:

```arduino
file1.txt file2.txt differ: byte 15, line 3
```

- Если файлы идентичны, cmp ничего не выводит.
- Опция `-s` подавляет вывод, полезна для использования в скриптах:
    
    ```bash
    cmp -s file1 file2 && echo "Файлы одинаковы" || echo "Файлы отличаются"
    ```
    

### Практическое применение:

#### Сравнение директорий

Часто нужно сравнить два каталога с файлами (например, резервные копии):

```nginx
diff -rq folder1/ folder2/
```

- `-r` — рекурсивно
- `-q` — краткий вывод

#### Сравнение и создание патчей

Частое использование diff — создание патчей для обновления файлов:

```nginx
diff -u original.txt modified.txt > changes.patch
```

Чтобы применить патч к исходному файлу, используйте команду patch:

```nginx
patch original.txt < changes.patch
```

Применить патч:

```nginx
patch original.txt < changes.patch
```

## Краткая шпаргалка по сравнению файлов

- `diff file1 file2` — построчное сравнение
- `diff -u` — удобный, унифицированный вывод
- `diff -r` — рекурсивное сравнение каталогов
- `comm file1 file2` — сравнение отсортированных файлов
- `cmp file1 file2` — быстрое побайтовое сравнение

## Итог

Теперь вы знаете три мощных и удобных инструмента — **diff**, **comm** и **cmp**, которые помогут быстро и эффективно сравнивать файлы и директории в Linux. Вы можете выбрать подходящий инструмент в зависимости от задачи — будь то детальное сравнение кода, быстрое сравнение двух файлов или анализ различий между каталогами.

В следующем уроке мы закрепим изученные инструменты на практических примерах.