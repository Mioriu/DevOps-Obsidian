## ![](https://ucarecdn.stepik.net/a8f62b7f-69ad-4551-893d-b345226cffe9/)

Анализ производительности процессов в Linux — это важнейшая задача администратора, позволяющая выявить и устранить проблемы с ресурсами, такие как перегрузка процессора, дефицит памяти, высокие задержки ввода-вывода или чрезмерное использование сети. В этом уроке подробно рассмотрим инструменты и методы анализа производительности процессов.

### Что именно анализировать?

При анализе производительности процессов важно обращать внимание на следующие ресурсы:

- **Процессор (CPU)** — выявить процессы, сильно нагружающие процессор.
- **Память (Memory)** — найти процессы, потребляющие много оперативной памяти.
- **Диски (I/O)** — определить процессы с высокой нагрузкой на дисковую подсистему.
- **Сеть (Network)** — найти процессы, создающие высокую сетевую нагрузку.

## Анализ загрузки процессора (CPU)

**top и htop** — самые удобные инструменты для анализа загрузки CPU в реальном времени.

- Запустите команду:
    
    ```css
    top
    ```
    
- Нажмите `P` для сортировки процессов по CPU. Обратите внимание на столбец `%CPU`.

Альтернативно используйте **htop**:

- Установка:
    
    ```bash
    sudo apt install htop
    ```
    
- Запуск:
    
    ```undefined
    htop
    ```
    
- Нажмите `F6` и выберите «CPU%» для сортировки по загрузке CPU.

```bash
ps -eo pid,comm,%cpu --sort=-%cpu | head
```

## pidstat для глубокого анализа CPU

**pidstat** (из пакета `sysstat`) предоставляет подробную статистику о нагрузке процессов на CPU:

```bash
sudo apt install sysstat
pidstat -u 2 5
```

- `-u` — статистика по CPU.
- `2 5` — интервал 2 секунды, повтор 5 раз.

### Анализ потребления памяти

Используйте команду `free`, чтобы быстро оценить состояние памяти:

```sql
free -h
```

Для анализа памяти, потребляемой процессами, используйте:

- Команду `ps`:
    
    ```bash
    ps aux --sort=-%mem | head
    ```
    
- Интерактивный мониторинг в **htop** (сортировка по памяти — нажмите `F6`, выберите MEM%):

Дополнительно, инструмент **smem** позволяет детально проанализировать использование памяти процессами:

- Установите smem:
    
    ```bash
    sudo apt install smem
    ```
    
- Запустите smem для подробного отчёта:
    
    ```bash
    sudo smem -kt
    ```
    

## Анализ нагрузки на дисковую подсистему (Disk I/O)

Высокая нагрузка на диск может серьёзно замедлить работу всей системы. Используйте утилиты **iostat** и **iotop**:

- Установка:
    
    ```bash
    sudo apt install sysstat iotop
    ```
    
- Запуск iostat для анализа дисковой активности:
    
    ```nginx
    iostat -xz 1 10
    ```
    
- Запуск iotop для выявления процессов с высокой нагрузкой на диск:
    
    ```bash
    sudo iotop -o
    ```
    

#### Расшифровка важных параметров iostat:

- `%util` — процент загруженности диска. Значения выше 80–90% указывают на перегрузку.
- `await` — среднее время ожидания операций ввода-вывода (чем выше, тем медленнее).

### Анализ сетевой активности процессов

Для определения процессов, активно использующих сеть, можно использовать **nethogs**:

- Установка:
    
    ```bash
    sudo apt install nethogs
    ```
    
- Запуск мониторинга:
    
    ```bash
    sudo nethogs
    ```
    

Эта утилита покажет процессы с текущим потреблением сети в реальном времени.

> Список утилит: 
> 
> ```1c
> nethogs   – сетевой трафик по процессам
> iftop     – сетевые соединения по интерфейсам
> ss -p     – показывает процессы, связанные с сокетами
> ```

## Использование утилиты perf для глубокого анализа производительности

**perf** — это мощный инструмент для профилирования производительности приложений и системы в целом.

- Установка:
    
    ```bash
    sudo apt install linux-tools-common linux-tools-$(uname -r)
    ```
    
- Профилирование конкретного процесса:
    
    ```css
    sudo perf top -p PID
    ```
    
- Запуск профилирования системы в реальном времени:
    
    ```bash
    sudo perf top
    ```
    

### Типичные сценарии и рекомендации

- **Высокая загрузка CPU:** идентифицируйте процессы через `top` и оптимизируйте их (снизьте приоритет, оптимизируйте код).
- **Нехватка памяти:** найдите процессы, занимающие много памяти, перезапустите или ограничьте их использование памяти через cgroups.
- **Высокий I/O:** проверьте процессы через `iotop` и оптимизируйте чтение/запись данных (кэширование, более быстрый диск).
- **Высокая сетевая активность:** проверьте процессы с помощью `nethogs`, настройте firewall или оптимизируйте работу приложений.

> ⚡ **Шпаргалка по анализу производительности**
> 
> - **CPU**: `ps -eo pid,comm,%cpu --sort=-%cpu | head`, `top` (P = сортировка по CPU).
>     
> - **Память**: `ps -eo pid,comm,%mem,rss --sort=-%mem | head`, `free -h`, `htop` (M = сортировка по памяти).
>     
> - **Диски (I/O)**: `iostat -xz 1 5`, `iotop -o` (только активные процессы).
>     
> - **Сеть**: `nethogs`, `iftop`, `ss -p`.
>     
> - **Профилирование**: `perf top`, `perf top -p <PID>`.
>