## ![](https://ucarecdn.stepik.net/3816e4e6-caa5-4a8c-9033-b9fbafeabe7a/)

При загрузке Linux происходят важные процессы, отвечающие за инициализацию системы и её компонентов. В этом уроке подробно рассмотрим два ключевых элемента процесса загрузки: загрузчик **GRUB** и систему начальной инициализации **initramfs**.

### Что такое GRUB?

**GRUB (GRand Unified Bootloader)** — основной загрузчик большинства Linux-дистрибутивов, который отвечает за запуск операционной системы после включения компьютера.

Основные функции GRUB:

- Выбор операционной системы или ядра при загрузке (особенно актуально при наличии нескольких систем).
- Передача параметров ядру Linux.
- Режим восстановления (Recovery Mode) и отладка загрузки (часто для подробных сообщений убирают параметры quiet и splash).

### Конфигурация GRUB

Основной конфигурационный файл GRUB:

```swift
/etc/default/grub
```

Пример типичного файла конфигурации:

```ini
GRUB_DEFAULT=0
GRUB_TIMEOUT=5
GRUB_CMDLINE_LINUX_DEFAULT="quiet splash"
GRUB_CMDLINE_LINUX=""
```

- `GRUB_DEFAULT` — номер пункта меню, загружаемого по умолчанию (нумерация с 0).
- `GRUB_TIMEOUT` — время ожидания в секундах до автоматической загрузки выбранного пункта.
- `GRUB_CMDLINE_LINUX_DEFAULT` — параметры ядра при нормальной загрузке.
- `GRUB_CMDLINE_LINUX` — дополнительные параметры ядра.

_**Основной конфигурационный файл GRUB находится по пути: /etc/default/grub**_

#### Обновление конфигурации GRUB

После изменений в конфигурации GRUB необходимо выполнить:

- Для Debian/Ubuntu:
    
    ```bash
    sudo update-grub
    ```
    
- Для CentOS/Fedora:
    
    ```bash
    sudo grub2-mkconfig -o /boot/grub2/grub.cfg
    ```
    

### Временные изменения параметров GRUB при загрузке

Иногда необходимо изменить параметры загрузки лишь временно (например, при сбоях загрузки или диагностике).

- Во время появления меню GRUB нажмите клавишу `e`.
- Отредактируйте нужную строку, например, удалив параметры `quiet splash` для просмотра подробных сообщений загрузки.
- Для запуска с новыми параметрами нажмите `Ctrl+X` или `F10`.

### Восстановление GRUB после сбоя

Если загрузчик повреждён (например, после переустановки Windows), его можно восстановить:

- Загрузитесь с Live USB/CD дистрибутива Linux.
- Откройте терминал и выполните команды:
    
    ```bash
    sudo mount /dev/sdXY /mnt
    sudo grub-install --root-directory=/mnt /dev/sdX
    sudo update-grub
    ```
    
    Здесь `/dev/sdXY` — раздел с Linux, `/dev/sdX` — диск с загрузчиком.

### Что такое initramfs?

**initramfs (initial RAM filesystem)** — это временная файловая система, загружаемая в оперативную память сразу после запуска ядра Linux. Её задача — подготовить необходимое окружение для монтирования основной файловой системы.

initramfs содержит:

- Драйверы для устройств хранения (например, RAID, LVM).
- Скрипты для инициализации устройств и файловых систем.
- Базовые инструменты для диагностики и восстановления системы.

### Где хранится образ initramfs?

Образы initramfs располагаются в директории:

```bash
/boot/initrd.img-версия-ядра
```

Проверить наличие образов initramfs можно командой:

```bash
ls /boot/initrd*
```

> initramfs обычно содержит драйверы устройств хранения и скрипты для монтирования корневой файловой системы.

### Генерация и обновление initramfs

После установки новых драйверов или изменения конфигурации системы initramfs нужно пересобрать:

- Debian/Ubuntu:
    
    ```bash
    sudo update-initramfs -u
    ```
    
- CentOS/Fedora:
    
    ```bash
    sudo dracut -f
    ```
    

Эти команды автоматически обновят initramfs для текущего ядра.

### Диагностика и работа с initramfs при сбоях

Если при загрузке Linux появляются ошибки, связанные с initramfs (например, невозможность найти корневую файловую систему), вы попадёте в аварийную оболочку initramfs:

- Проверьте доступность дисков и разделов:
    
    ```bash
    blkid
    ls /dev
    ```
    
- Попробуйте вручную смонтировать корневую систему и продолжить загрузку:
    
    ```bash
    mount /dev/sdXY /mnt
    exit
    ```
    

Если проблему решить не удаётся, пересоберите initramfs с Live USB или CD:

```bash
sudo mount /dev/sdXY /mnt
sudo chroot /mnt
update-initramfs -u
```